---
- hosts: webserver
  become: true
  tasks:
  
  - name: Install JDK
    yum: name=java-1.8.0-openjdk state=present update_cache=yes
      
  - name: Install EPEL repo.
    yum:
      name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
      state: present

  - name: Install tomcat
    yum: name=tomcat state=present update_cache=yes


  - name: Install tomcat webapps
    yum: name=tomcat-webapps state=present

  - name: Install tomcat admin-webapps
    yum: 
      name: tomcat-admin-webapps 
      state: present

  - name: Delete tomcat-users.xml
    file:
      path: /etc/tomcat/tomcat-users.xml
      state: absent

  - name: Copy tomcat-users.xml from Ansible Control Machine
    copy:
      src: tomcat-users.xml
      dest: /etc/tomcat/

  - name: Restart tomcat
    service: name=tomcat state=restarted

  - name: Copy artidacts from NEXUS
    get_url:
      url: http://52.25.161.119:8081/repository/Gol/Dev/Dev/{{BUILD_ID}}/Dev-{{BUILD_ID}}.war
      dest: /usr/share/tomcat/webapps/
      url_username: admin
      url_password: 1234
